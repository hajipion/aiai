function defineCloud(e){function t(e,t,n){if(void 0===t)throw"Argument "+e+" was not provided!";if(typeof t!=n)throw"Argument "+e+" was an unexpected type! Expected: "+n+", Received: "+typeof t}function n(n,o){t("data",n,"object"),t("callback",o,"function"),i(this),this.url||(this.url=this.restNamespace+"/"+this.restMethod+".json"),e.debug&&Ti.API.info('ACS Request: { url: "'+this.url+'", verb: "'+this.verb+'", data: '+JSON.stringify(n)+" })"),v.send(this.url,this.verb,n,function(t){if(o){var n=t.response||{};t.meta&&"ok"==t.meta.status?(n.success=!0,n.error=!1,n.meta=t.meta,e.debug&&Ti.API.info(JSON.stringify(n))):(n.success=!1,n.error=!0,n.code=t.meta?t.meta.code:t.statusCode,n.message=t.meta?t.meta.message:t.message||t.statusText,e.debug&&Ti.API.error(n.code+": "+n.message)),o(n)}})}function o(){n.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function r(e){n.call(this,{},e)}function i(e){e.restNamespace||(e.restNamespace=e.property.toLowerCase()),e.restMethod||(e.restMethod=e.method.toLowerCase())}function s(n,o){t("callback",o,"function");var r={};r.params=n||{},r.params.cb=function(t){if(o){var n=t||{};t&&t.access_token?(n.success=!0,n.error=!1,e.debug&&Ti.API.info("ACS Token: "+t.access_token+" Expires: "+t.expires_in)):(n.success=!1,n.error=!0,n.message="Cancelled",e.debug&&Ti.API.error("ACS "+n.message)),o(n)}},v.secureSend(this.method,r)}function a(){s.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function c(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var n=Array(80),o=1732584193,r=-271733879,i=-1732584194,s=271733878,a=-1009589776,c=0;e.length>c;c+=16){for(var l=o,d=r,p=i,h=s,f=a,m=0;80>m;m++){n[m]=16>m?e[c+m]:(n[m-3]^n[m-8]^n[m-14]^n[m-16])<<1|(n[m-3]^n[m-8]^n[m-14]^n[m-16])>>>31;var g,y=o<<5|o>>>27;g=20>m?r&i|~r&s:40>m?r^i^s:60>m?r&i|r&s|i&s:r^i^s,y=u(u(y,g),u(u(a,n[m]),20>m?1518500249:40>m?1859775393:60>m?-1894007588:-899497514)),a=s,s=i,i=r<<30|r>>>2,r=o,o=y}o=u(o,l),r=u(r,d),i=u(i,p),s=u(s,h),a=u(a,f)}return[o,r,i,s,a]}function u(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function l(e){for(var t=[],n=(1<<y)-1,o=0;e.length*y>o;o+=y)t[o>>5]|=(e.charCodeAt(o/y)&n)<<32-y-o%32;return t}function d(e,t,n,o,r){var i=!1;return this.appKey=e,this.oauthKey=t,this.oauthSecret=n,this.apiBaseURL=o?o:p.sdk.url.baseURL,this.authBaseURL=r?r:p.sdk.url.authBaseURL,this.useThreeLegged=function(e){i=e,this.oauthKey||(this.oauthKey=this.appKey)},this.isThreeLegged=function(){return i},this}var p,h={PROPERTY_TYPE_ONLY_LATEST:0,PROPERTY_TYPE_SLASH_COMBINE:1,PROPERTY_TYPE_IGNORE:2};h.build=function f(e,t){var n,o=t.children||[];for(n in o)if(o.hasOwnProperty(n)){var r=o[n],i=r.propertyTypes||t.propertyTypes||{};i.children=h.PROPERTY_TYPE_IGNORE;for(var s in t)if(t.hasOwnProperty(s))switch(i[s]||h.PROPERTY_TYPE_ONLY_LATEST){case h.PROPERTY_TYPE_ONLY_LATEST:r[s]=void 0===r[s]?t[s]:r[s];break;case h.PROPERTY_TYPE_SLASH_COMBINE:var a=[];t[s]&&a.push(t[s]),r[s]&&a.push(r[s]),r[s]=a.join("/")}r.method&&!r.children?e[r.method]=function(e){return function(){return e.executor.apply(e,arguments)}}(r):r.property&&f(e[r.property]={},r)}},h.build(e,{verb:"GET",executor:n,children:[{method:"hasStoredSession",executor:function(){return Ti.API.warn("Cloud.hasStoredSession has been deprecated. Use Cloud.sessionId property"),v.hasStoredSession()}},{method:"retrieveStoredSession",executor:function(){return Ti.API.warn("Cloud.retrieveStoredSession has been deprecated. Use Cloud.sessionId property"),v.retrieveStoredSession()}},{property:"ACLs",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"addUser",restMethod:"add",verb:"POST"},{method:"removeUser",restMethod:"remove",verb:"DELETE"},{method:"checkUser",restMethod:"check"}]},{property:"Chats",children:[{method:"create",verb:"POST"},{method:"query"},{method:"getChatGroups",restMethod:"get_chat_groups",executor:o}]},{property:"Checkins",children:[{method:"create",verb:"POST"},{method:"query",executor:o},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Clients",children:[{method:"geolocate",executor:o}]},{property:"Objects",executor:function(e,o){var r;e&&"object"==typeof e&&(t("data.classname",e.classname,"string"),i(this),this.url=this.restNamespace+"/"+e.classname+"/"+this.restMethod+".json",r=e.classname,delete e.classname),n.call(this,e,o),e.classname=r},children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query"}]},{property:"Emails",restNamespace:"custom_mailer",children:[{method:"send",verb:"POST",restMethod:"email_from_template"}]},{property:"Events",children:[{method:"create",verb:"POST"},{method:"show"},{method:"showOccurrences",restMethod:"show/occurrences"},{method:"query",executor:o},{method:"queryOccurrences",restMethod:"query/occurrences",executor:o},{method:"search",executor:o},{method:"searchOccurrences",restMethod:"search/occurrences",executor:o},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Files",children:[{method:"create",verb:"POST"},{method:"query",executor:o},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Friends",children:[{method:"add",verb:"POST"},{method:"requests",executor:o},{method:"approve",verb:"PUT"},{method:"remove",verb:"DELETE"},{method:"search"}]},{property:"KeyValues",children:[{method:"set",verb:"PUT"},{method:"get"},{method:"append",verb:"PUT"},{method:"increment",restMethod:"incrby",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Messages",children:[{method:"create",verb:"POST"},{method:"reply",verb:"POST"},{method:"show"},{method:"showInbox",restMethod:"show/inbox",executor:o},{method:"showSent",restMethod:"show/sent",executor:o},{method:"showThreads",restMethod:"show/threads",executor:o},{method:"showThread",restMethod:"show/thread"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"removeThread",restMethod:"delete/thread",verb:"DELETE"}]},{property:"Photos",children:[{method:"create",verb:"POST"},{method:"show"},{method:"search"},{method:"query",executor:o},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PhotoCollections",restNamespace:"collections",children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"search"},{method:"showSubcollections",restMethod:"show/subcollections"},{method:"showPhotos",restMethod:"show/photos"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Places",children:[{method:"create",verb:"POST"},{method:"search",executor:o},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query",executor:o}]},{property:"Posts",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query",executor:o},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PushNotifications",restNamespace:"push_notification",verb:"POST",children:[{method:"subscribe"},{method:"unsubscribe",verb:"DELETE"},{method:"notify"},{method:"subscribeToken",restMethod:"subscribe_token",verb:"POST"},{method:"unsubscribeToken",restMethod:"unsubscribe_token",verb:"DELETE"},{method:"notifyTokens",restMethod:"notify_tokens",verb:"POST"}]},{property:"Reviews",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"SocialIntegrations",restNamespace:"users",children:[{method:"externalAccountLogin",restMethod:"external_account_login",verb:"POST"},{method:"externalAccountLink",restMethod:"external_account_link",verb:"POST"},{method:"externalAccountUnlink",restMethod:"external_account_unlink",verb:"DELETE"},{method:"searchFacebookFriends",restNamespace:"social",restMethod:"facebook/search_friends",executor:r}]},{property:"Statuses",children:[{method:"create",verb:"POST"},{method:"search"},{method:"query",executor:o}]},{property:"Users",children:[{method:"create",verb:"POST"},{method:"login",verb:"POST"},{method:"show"},{method:"showMe",restMethod:"show/me",executor:r},{method:"search",executor:o},{method:"query",executor:o},{method:"update",verb:"PUT"},{method:"logout",executor:function(e){n.call(this,{},function(t){v.reset(),e(t)})}},{method:"remove",restMethod:"delete",verb:"DELETE",executor:function(){var e=arguments;n.call(this,2==e.length?e[0]:{},function(t){v.reset(),(2==e.length?e[1]:e[0])(t)})}},{method:"requestResetPassword",restMethod:"request_reset_password"},{method:"secureCreate",executor:a},{method:"secureLogin",executor:a},{method:"secureStatus",executor:function(){return v.checkStatus()}}]}]});var m;null==m&&(m={}),m.setProperties=function(e,t){if(null!=e&&null!=t)for(var n in t)e[n]=t[n];return e},m.setProperties(m,{percentEncode:function(e){if(null==e)return"";if(e instanceof Array){for(var t="";e.length>0;++e)""!=t&&(t+="&"),t+=m.percentEncode(e[0]);return t}return e=encodeURIComponent(e),e=e.replace(/\!/g,"%21"),e=e.replace(/\*/g,"%2A"),e=e.replace(/\'/g,"%27"),e=e.replace(/\(/g,"%28"),e=e.replace(/\)/g,"%29")},decodePercent:function(e){return null!=e&&(e=e.replace(/\+/g," ")),decodeURIComponent(e)},getParameterList:function(e){if(null==e)return[];if("object"!=typeof e)return m.decodeForm(e+"");if(e instanceof Array)return e;var t,n=[];for(t in e)n.push([t,e[t]]);return n},getParameterMap:function(e){if(null==e)return{};if("object"!=typeof e)return m.getParameterMap(m.decodeForm(e+""));if(e instanceof Array){for(var t={},n=0;e.length>n;++n){var o=e[n][0];void 0===t[o]&&(t[o]=e[n][1])}return t}return e},getParameter:function(e,t){if(!(e instanceof Array))return m.getParameterMap(e)[t];for(var n=0;e.length>n;++n)if(e[n][0]==t)return e[n][1];return null},formEncode:function(e){for(var t="",e=m.getParameterList(e),n=0;e.length>n;++n){var o=e[n][1];null==o&&(o=""),""!=t&&(t+="&"),t+=m.percentEncode(e[n][0])+"="+m.percentEncode(o)}return t},decodeForm:function(e){for(var t=[],e=e.split("&"),n=0;e.length>n;++n){var o=e[n];if(""!=o){var r,i=o.indexOf("=");0>i?(r=m.decodePercent(o),o=null):(r=m.decodePercent(o.substring(0,i)),o=m.decodePercent(o.substring(i+1))),t.push([r,o])}}return t},setParameter:function(e,t,n){var o=e.parameters;if(o instanceof Array){for(e=0;o.length>e;++e)o[e][0]==t&&(void 0===n?o.splice(e,1):(o[e][1]=n,n=void 0));void 0!==n&&o.push([t,n])}else o=m.getParameterMap(o),o[t]=n,e.parameters=o},setParameters:function(e,t){for(var n=m.getParameterList(t),o=0;n.length>o;++o)m.setParameter(e,n[o][0],n[o][1])},completeRequest:function(e,t){null==e.method&&(e.method="GET");var n=m.getParameterMap(e.parameters);null==n.oauth_consumer_key&&m.setParameter(e,"oauth_consumer_key",t.consumerKey||""),null==n.oauth_token&&null!=t.token&&m.setParameter(e,"oauth_token",t.token),null==n.oauth_version&&m.setParameter(e,"oauth_version","1.0"),null==n.oauth_timestamp&&m.setParameter(e,"oauth_timestamp",m.timestamp()),null==n.oauth_nonce&&m.setParameter(e,"oauth_nonce",m.nonce(6)),m.SignatureMethod.sign(e,t)},setTimestampAndNonce:function(e){m.setParameter(e,"oauth_timestamp",m.timestamp()),m.setParameter(e,"oauth_nonce",m.nonce(6))},addToURL:function(e,t){if(newURL=e,null!=t){var n=m.formEncode(t);n.length>0&&(newURL=0>e.indexOf("?")?newURL+"?":newURL+"&",newURL+=n)}return newURL},getAuthorizationHeader:function(e,t){for(var n='OAuth realm="'+m.percentEncode(e)+'"',o=m.getParameterList(t),r=0;o.length>r;++r){var i=o[r],s=i[0];0==s.indexOf("oauth_")&&(n+=","+m.percentEncode(s)+'="'+m.percentEncode(i[1])+'"')}return n},correctTimestamp:function(e){m.timeCorrectionMsec=1e3*e-(new Date).getTime()},timeCorrectionMsec:0,timestamp:function(){var e=(new Date).getTime()+m.timeCorrectionMsec;return Math.floor(e/1e3)},nonce:function(e){for(var t=m.nonce.CHARS,n="",o=0;e>o;++o)var r=Math.floor(Math.random()*t.length),n=n+t.substring(r,r+1);return n}}),m.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",m.declareClass=function(e,t,n){var o=e[t];if(e[t]=n,null!=n&&null!=o)for(var r in o)"prototype"!=r&&(n[r]=o[r]);return n},m.declareClass(m,"SignatureMethod",function(){}),m.setProperties(m.SignatureMethod.prototype,{sign:function(e){var t=this.getSignature(m.SignatureMethod.getBaseString(e));return m.setParameter(e,"oauth_signature",t),t},initialize:function(e,t){var n;n=null!=t.accessorSecret&&e.length>9&&"-Accessor"==e.substring(e.length-9)?t.accessorSecret:t.consumerSecret,this.key=m.percentEncode(n)+"&"+m.percentEncode(t.tokenSecret)}}),m.setProperties(m.SignatureMethod,{sign:function(e,t){var n=m.getParameterMap(e.parameters).oauth_signature_method;(null==n||""==n)&&(n="HMAC-SHA1",m.setParameter(e,"oauth_signature_method",n)),m.SignatureMethod.newMethod(n,t).sign(e)},newMethod:function(e,t){var n=m.SignatureMethod.REGISTERED[e];if(null!=n){var o=new n;return o.initialize(e,t),o}var n=Error("signature_method_rejected"),r="";for(o in m.SignatureMethod.REGISTERED)""!=r&&(r+="&"),r+=m.percentEncode(o);throw n.oauth_acceptable_signature_methods=r,n},REGISTERED:{},registerMethodClass:function(e,t){for(var n=0;e.length>n;++n)m.SignatureMethod.REGISTERED[e[n]]=t},makeSubclass:function(e){var t=m.SignatureMethod,n=function(){t.call(this)};return n.prototype=new t,n.prototype.getSignature=e,n.prototype.constructor=n},getBaseString:function(e){var t=e.action,n=t.indexOf("?");if(0>n)n=e.parameters;else for(var n=m.decodeForm(t.substring(n+1)),o=m.getParameterList(e.parameters),r=0;o.length>r;++r)n.push(o[r]);return m.percentEncode(e.method.toUpperCase())+"&"+m.percentEncode(m.SignatureMethod.normalizeUrl(t))+"&"+m.percentEncode(m.SignatureMethod.normalizeParameters(n))},normalizeUrl:function(e){var t=m.SignatureMethod.parseUri(e),e=t.protocol.toLowerCase(),n=t.authority.toLowerCase();if("http"==e&&80==t.port||"https"==e&&443==t.port){var o=n.lastIndexOf(":");o>=0&&(n=n.substring(0,o))}return(t=t.path)||(t="/"),e+"://"+n+t},parseUri:function(e){for(var t="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(","),e=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),n={},o=14;o--;)n[t[o]]=e[o]||"";return n},normalizeParameters:function(e){if(null==e)return"";for(var t=m.getParameterList(e),e=[],n=0;t.length>n;++n){var o=t[n];"oauth_signature"!=o[0]&&e.push([m.percentEncode(o[0])+" "+m.percentEncode(o[1]),o])}for(e.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),t=[],n=0;e.length>n;++n)t.push(e[n][1]);return m.formEncode(t)}}),m.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],m.SignatureMethod.makeSubclass(function(){return this.key})),m.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],m.SignatureMethod.makeSubclass(function(e){g="=";var t=this.key,n=l(t);n.length>16&&(n=c(n,t.length*y));for(var o=Array(16),t=Array(16),r=0;16>r;r++)o[r]=909522486^n[r],t[r]=1549556828^n[r];for(e=c(o.concat(l(e)),512+e.length*y),e=c(t.concat(e),672),n="",t=0;4*e.length>t;t+=3)for(o=(255&e[t>>2]>>8*(3-t%4))<<16|(255&e[t+1>>2]>>8*(3-(t+1)%4))<<8|255&e[t+2>>2]>>8*(3-(t+2)%4),r=0;4>r;r++)n=8*t+6*r>32*e.length?n+g:n+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&o>>6*(3-r));return n}));var g="",y=8;d.prototype.sendRequest=function(e,t,n,o){var r=p.js.sdk.utils.getAuthType(this);if(r==p.constants.unknown)o(p.constants.noAppKeyError);else{var i=this.apiBaseURL+"/"+p.sdk.url.version+"/"+e,i=r==p.constants.app_key?i+(p.constants.keyParam+this.appKey):i+(p.constants.oauthKeyParam+this.oauthKey);if(null==n&&(n={}),t=t?t.toUpperCase():p.constants.get_method,n[p.constants.suppressCode]="true",!this.isThreeLegged()){var s=p.js.sdk.utils.getCookie(p.constants.sessionId);s||(s=this.session_id),s&&(i=-1!=i.indexOf("?")?i+("&"+p.constants.sessionId+"="+s):i+("?"+p.constants.sessionId+"="+s))}if(this.isThreeLegged()&&(!this.accessToken&&(s=this.getSession())&&(this.accessToken=s.access_token),this.accessToken&&(n[p.constants.accessToken]=this.accessToken)),s=n,Ti.App.analytics){var a=s.analytics||{};a.id=Ti.Platform.createUUID(),Ti.Platform.id&&(a.mid=Ti.Platform.id),a.aguid=Ti.App.guid,a.event="cloud."+e.replace(/\//g,".").replace(/\.json/,""),a.deploytype=Ti.App.deployType||"development",a.sid=Ti.App.sessionId,s.ti_analytics=JSON.stringify(a)}if(n=p.js.sdk.utils.cleanInvalidData(n),e=p.js.sdk.utils.getFileObject(n)){try{var c;if(c=(""+e).match(/TiFilesystemFile/)?e.read():e,!c)return o(p.constants.fileLoadError),void 0;n[p.constants.file]?(delete n[p.constants.file],n[p.constants.file]=c):n[p.constants.photo]&&(delete n[p.constants.photo],n[p.constants.photo]=c)}catch(u){return o(p.constants.fileLoadError),void 0}c={},(r==p.constants.oauth||r==p.constants.three_legged_oauth)&&(r={method:t,action:i,parameters:[]},p.js.sdk.utils.populateOAuthParameters(r.parameters,this.oauthKey),this.oauthSecret&&m.completeRequest(r,{consumerSecret:this.oauthSecret}),c[p.constants.oauth_header]=m.getAuthorizationHeader("",r.parameters))}else if(c={},r==p.constants.oauth||r==p.constants.three_legged_oauth){var l,r={method:t,action:i,parameters:[]};for(l in n)n.hasOwnProperty(l)&&r.parameters.push([l,n[l]]);p.js.sdk.utils.populateOAuthParameters(r.parameters,this.oauthKey),this.oauthSecret&&m.completeRequest(r,{consumerSecret:this.oauthSecret}),c[p.constants.oauth_header]=m.getAuthorizationHeader("",r.parameters)}p.js.sdk.utils.sendAppceleratorRequest(i,t,n,c,o,this)}},d.prototype.sendAuthRequest=function(e){if(p.js.sdk.utils.getAuthType(this)!==p.constants.three_legged_oauth)alert("wrong authorization type!");else{var e=e||{},t=this.authBaseURL,t=t+"/oauth/authorize"+(p.constants.oauthKeyParam+this.oauthKey),t=t+(p.constants.clientIdParam+this.oauthKey),t=t+(p.constants.responseTypeParam+"token"),e=e.params||{};e.action="login",e.url=t;var n=this,o=e.cb;o&&delete e.cb,p.js.sdk.ui(e,function(e){n.saveSession(e),o&&o(e)})}},d.prototype.signUpRequest=function(e){if(p.js.sdk.utils.getAuthType(this)!==p.constants.three_legged_oauth)alert("wrong authorization type!");else{var e=e||{},t=this.authBaseURL,t=t+"/users/sign_up"+(p.constants.oauthKeyParam+this.oauthKey),t=t+(p.constants.clientIdParam+this.oauthKey),e=e.params||{};e.action="signup",e.url=t;var n=this,o=e.cb;o&&delete e.cb,p.js.sdk.ui(e,function(e){n.saveSession(e),o&&o(e)})}},d.prototype.saveSession=function(e){return e&&e.access_token?(p.js.sdk.utils.setCookie(p.constants.accessToken,e.access_token),p.js.sdk.utils.setCookie(p.constants.expiresIn,e.expires_in),this.accessToken=e.access_token,this.expiresIn=e.expires_in,this.authorized=!0):this.authorized=!1},d.prototype.getSession=function(){var e={};return e.access_token=p.js.sdk.utils.getCookie(p.constants.accessToken),e.expires_in=p.js.sdk.utils.getCookie(p.constants.expiresIn),e.access_token?(this.accessToken=e.access_token,this.expiresIn=e.expires_in,this.authorized=!0,e):this.authorized=!1},d.prototype.clearSession=function(){p.js.sdk.utils.setCookie(p.constants.accessToken,""),p.js.sdk.utils.setCookie(p.constants.expiresIn,""),delete this.accessToken,delete this.expiresIn,this.authorized=!1},d.prototype.checkStatus=function(){return this.getSession()?!0:!1},p=void 0,p={constants:{},js:{}},p.js.sdk={},p.js.sdk.utils={},p.sdk={},p.sdk.url={},p.sdk.url.baseURL="https://api.cloud.appcelerator.com",p.sdk.url.authBaseURL="https://secure-identity.cloud.appcelerator.com",p.sdk.url.version="v1",p.constants.get_method="GET",p.constants.post_method="POST",p.constants.put_method="PUT",p.constants.delete_method="DELETE",p.constants.app_key=1,p.constants.oauth=2,p.constants.three_legged_oauth=3,p.constants.unknown=-1,p.constants.keyParam="?key=",p.constants.oauthKeyParam="?oauth_consumer_key=",p.constants.clientIdParam="&client_id=",p.constants.redirectUriParam="&redirect_uri=",p.constants.responseTypeParam="&response_type=",p.constants.accessToken="access_token",p.constants.expiresIn="expires_in",p.constants.appKey="app_key",p.constants.json="json",p.constants.sessionId="_session_id",p.constants.sessionCookieName="Cookie",p.constants.responseCookieName="Set-Cookie",p.constants.file="file",p.constants.suppressCode="suppress_response_codes",p.constants.response_wrapper="response_wrapper",p.constants.photo="photo",p.constants.method="_method",p.constants.name="name",p.constants.value="value",p.constants.oauth_header="Authorization",p.constants.noAppKeyError={meta:{status:"fail",code:409,message:"Application key is not provided."}},p.constants.fileLoadError={meta:{status:"fail",code:400,message:"Unable to load file"}},p.js.sdk.utils.getSessionParams=function(){var e=null,t=p.js.sdk.utils.getCookie(p.constants.sessionId);return t&&(e=p.constants.sessionId+"="+t),e},p.js.sdk.utils.cookieMap=[],p.js.sdk.utils.cookieMap[p.constants.sessionId]="sessionId",p.js.sdk.utils.cookieMap[p.constants.accessToken]="accessToken",p.js.sdk.utils.cookieMap[p.constants.expiresIn]="expiresIn",p.js.sdk.utils.getCookie=function(t){return(t=p.js.sdk.utils.cookieMap[t])&&e[t]||null},p.js.sdk.utils.setCookie=function(t,n){var o=p.js.sdk.utils.cookieMap[t];o&&(""===n?delete e[o]:e[o]=n)},p.js.sdk.utils.deleteCookie=function(t){(t=p.js.sdk.utils.cookieMap[t])&&delete e[t]},p.js.sdk.utils.getAuthType=function(e){if(e){if(e.isThreeLegged())return p.constants.three_legged_oauth;if(e.appKey)return p.constants.app_key;if(e.oauthKey&&e.oauthSecret)return p.constants.oauth}return p.constants.unknown},p.js.sdk.utils.getFileObject=function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)&&(t==p.constants.photo||t==p.constants.file))return e[t];return null},p.js.sdk.utils.cleanInvalidData=function(e){if(e){for(var t in e)if(e.hasOwnProperty(t)){if(null==e[t]&&delete e[t],"object"==typeof e[t]){if(t==p.constants.photo||t==p.constants.file)continue;e[t]=JSON.stringify(e[t])}(!0===e[t]||!1===e[t])&&(e[t]=e[t]?1:0)}return e}return{}},p.js.sdk.utils.uploadMessageCallback=function(e){return e&&e.data?JSON.parse(e.data):{}},p.js.sdk.utils.getOAuthParameters=function(e){var t="";if(e)for(var e=m.getParameterList(e),n=0;e.length>n;++n){var o=e[n],r=o[0];0==r.indexOf("oauth_")&&"oauth_token"!=r&&(t+="&"+m.percentEncode(r)+"="+m.percentEncode(o[1]))}return t.length>0&&(t=t.substring(1)),t},p.js.sdk.utils.populateOAuthParameters=function(e,t){e&&t&&(e.push(["oauth_version","1.0"]),e.push(["oauth_consumer_key",t]),e.push(["oauth_signature_method","HMAC-SHA1"]),e.push(["oauth_nonce",m.nonce(15)]))},p.js.sdk.utils.sendAppceleratorRequest=function(t,n,o,r,i,s){var a=Ti.Network.createHTTPClient({timeout:6e4,onsendstream:function(n){e.onsendstream&&e.onsendstream({url:t,progress:n.progress})},ondatastream:function(n){e.ondatastream&&e.ondatastream({url:t,progress:n.progress})},onerror:function(e){var t={};if(this.responseText){var n=this.responseText;try{(n=n.trim())&&n.length>0&&(t=JSON.parse(n))}catch(o){t=o}}t.message||(t.message=e.error),t.error=!0,t.statusText=this.statusText,t.status=this.status,t.meta&&(t.metaString=JSON.stringify(t.meta)),i(t)},onload:function(){var e=JSON.parse(this.responseText);if(e&&e.meta&&(e.metaString=JSON.stringify(e.meta),e.meta.session_id)){var t=e.meta.session_id;p.js.sdk.utils.setCookie(p.constants.sessionId,t),s.session_id=t}i(e)}}),c=t;if(n.toUpperCase()==p.constants.get_method||n.toUpperCase()==p.constants.delete_method){var u,l="";for(u in o)o.hasOwnProperty(u)&&(l+="&"+u+"="+m.percentEncode(o[u]));l.length>0&&(c=t.indexOf("?")>0?c+l:c+("?"+l.substring(1)),o={})}if(e.debug&&(Ti.API.info(n+": "+c),Ti.API.info("header: "+JSON.stringify(r)),Ti.API.info("data: "+JSON.stringify(o))),a.open(n,c),"mobileweb"!=Ti.Platform.osname&&a.setRequestHeader("Accept-Encoding","gzip,deflate"),r)for(u in r)r.hasOwnProperty(u)&&a.setRequestHeader(u,r[u]);a.send(o)},p.js.sdk.utils.decodeQS=function(e){var t,n,o=decodeURIComponent,r={},e=e.split("&");for(t=0;e.length>t;t++)(n=e[t].split("=",2))&&n[0]&&(r[o(n[0])]=o(n[1]));return r},p.js.sdk.utils.guid=function(){return"f"+(1073741824*Math.random()).toString(16).replace(".","")},p.js.sdk.utils.copy=function(e,t,n,o){for(var r in t)(n||e[r]===void 0)&&(e[r]=o?o(t[r]):t[r]);return e};var v={session:null,fetchSetting:function(e,t){var n,o="production"==Ti.App.deployType.toLowerCase()?"production":"development";return(n=Ti.App.Properties.getString(e+"-"+o))&&"undefined"!=n||(n=Ti.App.Properties.getString(e))&&"undefined"!=n?n:t},fetchSession:function(){var e=v.fetchSetting("acs-api-key",null),t=v.fetchSetting("acs-base-url",p.sdk.url.baseURL),n=v.fetchSetting("acs-authbase-url",p.sdk.url.authBaseURL),o=v.fetchSetting("acs-oauth-key",null),r=v.fetchSetting("acs-oauth-secret",null);return new d(e,o,r,t,n)}};return v.getSession=function(){return null==v.session&&(v.session=v.fetchSession()),v.session},v.send=function(e,t,n,o){v.getSession().sendRequest(e,t,n,o)},v.hasStoredSession=function(){return!!p.js.sdk.utils.getCookie(p.constants.sessionId)},v.retrieveStoredSession=function(){return p.js.sdk.utils.getCookie(p.constants.sessionId)},v.reset=function(){p.js.sdk.utils.deleteCookie(p.constants.sessionId),v.session&&(v.session.clearSession(),v.session=null)},v.secureSend=function(e,t){var n=v.getSession();n.useThreeLegged(!0),"secureCreate"===e?n.signUpRequest(t):"secureLogin"===e&&n.sendAuthRequest(t)},v.checkStatus=function(){return v.getSession().checkStatus()},p.js.sdk.UIManager={redirect_uri:"acsconnect://success",displayModal:function(t){function n(e){var t=/^acsconnect:\/\/([^#]*)#(.*)/.exec(decodeURIComponent(e.url));if(t&&3==t.length){var a=null;if("success"==t[1])a=p.js.sdk.utils.decodeQS(t[2]);else if("cancel"!=t[1])return;i.removeEventListener("beforeload",n),i.removeEventListener("load",n),o=a,r&&r.close()}s&&"load"==e.type&&(r.remove(s),s=null)}e.debug&&Ti.API.info("ThreeLegged Request url: "+t.url);var o,r=Ti.UI.createWindow({modal:!0,title:t.params.title||"Appcelerator Cloud Service"}),i=Ti.UI.createWebView({url:t.url,scalesPageToFit:!1,showScrollbars:!0}),s=Ti.UI.createLabel({text:"Loading, please wait...",color:"black",width:Ti.UI.SIZE||"auto",height:Ti.UI.SIZE||"auto",zIndex:100});if(i.addEventListener("beforeload",n),i.addEventListener("load",n),r.addEventListener("close",function(){t&&(t.cb&&t.cb(o),i=r=s=t=o=null)}),"android"!=Ti.Platform.osname){var a=Ti.UI.createButton({title:"close",width:"50%",height:"20%"});a.addEventListener("click",function(){r.close()}),r.rightNavButton=a}r.add(i),r.add(s),r.open()},processParams:function(e,t){return{cb:t,url:e.url+p.constants.redirectUriParam+p.js.sdk.UIManager.redirect_uri,params:e}}},p.js.sdk.ui=function(e,t){if("mobileweb"===Ti.Platform.osname)alert("Three Legged OAuth is not currently supported on MobileWeb");else if(e.action){var n=p.js.sdk.UIManager.processParams(e,t);n&&p.js.sdk.UIManager.displayModal(n)}else alert('"action" is a required parameter for com.cocoafish.js.sdk.ui().')},e}defineCloud(exports);