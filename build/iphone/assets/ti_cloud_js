function defineCloud(e){function t(e,t,o){if(void 0===t)throw"Argument "+e+" was not provided!";if(typeof t!=o)throw"Argument "+e+" was an unexpected type! Expected: "+o+", Received: "+typeof t}function o(o,r){t("data",o,"object"),t("callback",r,"function"),n(this),this.url||(this.url=this.restNamespace+"/"+this.restMethod+".json"),e.debug&&Ti.API.info('ACS Request: { url: "'+this.url+'", verb: "'+this.verb+'", data: '+JSON.stringify(o)+" })"),v.send(this.url,this.verb,o,function(t){if(r){var o=t.response||{};t.meta&&"ok"==t.meta.status?(o.success=!0,o.error=!1,o.meta=t.meta,e.debug&&Ti.API.info(JSON.stringify(o))):(o.success=!1,o.error=!0,o.code=t.meta?t.meta.code:t.statusCode,o.message=t.meta?t.meta.message:t.message||t.statusText,e.debug&&Ti.API.error(o.code+": "+o.message)),r(o)}})}function r(){o.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function s(e){o.call(this,{},e)}function n(e){e.restNamespace||(e.restNamespace=e.property.toLowerCase()),e.restMethod||(e.restMethod=e.method.toLowerCase())}function a(o,r){t("callback",r,"function");var s={};s.params=o||{},s.params.cb=function(t){if(r){var o=t||{};t&&t.access_token?(o.success=!0,o.error=!1,e.debug&&Ti.API.info("ACS Token: "+t.access_token+" Expires: "+t.expires_in)):(o.success=!1,o.error=!0,o.message="Cancelled",e.debug&&Ti.API.error("ACS "+o.message)),r(o)}},v.secureSend(this.method,s)}function i(){a.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function c(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var o=Array(80),r=1732584193,s=-271733879,n=-1732584194,a=271733878,i=-1009589776,c=0;e.length>c;c+=16){for(var u=r,h=s,l=n,p=a,m=i,g=0;80>g;g++){o[g]=16>g?e[c+g]:(o[g-3]^o[g-8]^o[g-14]^o[g-16])<<1|(o[g-3]^o[g-8]^o[g-14]^o[g-16])>>>31;var f,T=r<<5|r>>>27;f=20>g?s&n|~s&a:40>g?s^n^a:60>g?s&n|s&a|n&a:s^n^a,T=d(d(T,f),d(d(i,o[g]),20>g?1518500249:40>g?1859775393:60>g?-1894007588:-899497514)),i=a,a=n,n=s<<30|s>>>2,s=r,r=T}r=d(r,u),s=d(s,h),n=d(n,l),a=d(a,p),i=d(i,m)}return[r,s,n,a,i]}function d(e,t){var o=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(o>>16)<<16|65535&o}function u(e){for(var t=[],o=(1<<T)-1,r=0;e.length*T>r;r+=T)t[r>>5]|=(e.charCodeAt(r/T)&o)<<32-T-r%32;return t}function h(e,t,o,r,s){var n=!1;return this.appKey=e,this.oauthKey=t,this.oauthSecret=o,this.apiBaseURL=r?r:l.sdk.url.baseURL,this.authBaseURL=s?s:l.sdk.url.authBaseURL,this.useThreeLegged=function(e){n=e,this.oauthKey||(this.oauthKey=this.appKey)},this.isThreeLegged=function(){return n},this}var l,p={PROPERTY_TYPE_ONLY_LATEST:0,PROPERTY_TYPE_SLASH_COMBINE:1,PROPERTY_TYPE_IGNORE:2};p.build=function m(e,t){var o,r=t.children||[];for(o in r)if(r.hasOwnProperty(o)){var s=r[o],n=s.propertyTypes||t.propertyTypes||{};n.children=p.PROPERTY_TYPE_IGNORE;for(var a in t)if(t.hasOwnProperty(a))switch(n[a]||p.PROPERTY_TYPE_ONLY_LATEST){case p.PROPERTY_TYPE_ONLY_LATEST:s[a]=void 0===s[a]?t[a]:s[a];break;case p.PROPERTY_TYPE_SLASH_COMBINE:var i=[];t[a]&&i.push(t[a]),s[a]&&i.push(s[a]),s[a]=i.join("/")}s.method&&!s.children?e[s.method]=function(e){return function(){return e.executor.apply(e,arguments)}}(s):s.property&&m(e[s.property]={},s)}},p.build(e,{verb:"GET",executor:o,children:[{method:"hasStoredSession",executor:function(){return Ti.API.warn("Cloud.hasStoredSession has been deprecated. Use Cloud.sessionId property"),v.hasStoredSession()}},{method:"retrieveStoredSession",executor:function(){return Ti.API.warn("Cloud.retrieveStoredSession has been deprecated. Use Cloud.sessionId property"),v.retrieveStoredSession()}},{property:"ACLs",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"addUser",restMethod:"add",verb:"POST"},{method:"removeUser",restMethod:"remove",verb:"DELETE"},{method:"checkUser",restMethod:"check"}]},{property:"Chats",children:[{method:"create",verb:"POST"},{method:"query"},{method:"getChatGroups",restMethod:"get_chat_groups",executor:r}]},{property:"Checkins",children:[{method:"create",verb:"POST"},{method:"query",executor:r},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Clients",children:[{method:"geolocate",executor:r}]},{property:"Objects",executor:function(e,r){var s;e&&"object"==typeof e&&(t("data.classname",e.classname,"string"),n(this),this.url=this.restNamespace+"/"+e.classname+"/"+this.restMethod+".json",s=e.classname,delete e.classname),o.call(this,e,r),e.classname=s},children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query"}]},{property:"Emails",restNamespace:"custom_mailer",children:[{method:"send",verb:"POST",restMethod:"email_from_template"}]},{property:"Events",children:[{method:"create",verb:"POST"},{method:"show"},{method:"showOccurrences",restMethod:"show/occurrences"},{method:"query",executor:r},{method:"queryOccurrences",restMethod:"query/occurrences",executor:r},{method:"search",executor:r},{method:"searchOccurrences",restMethod:"search/occurrences",executor:r},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Files",children:[{method:"create",verb:"POST"},{method:"query",executor:r},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Friends",children:[{method:"add",verb:"POST"},{method:"requests",executor:r},{method:"approve",verb:"PUT"},{method:"remove",verb:"DELETE"},{method:"search"}]},{property:"KeyValues",children:[{method:"set",verb:"PUT"},{method:"get"},{method:"append",verb:"PUT"},{method:"increment",restMethod:"incrby",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Messages",children:[{method:"create",verb:"POST"},{method:"reply",verb:"POST"},{method:"show"},{method:"showInbox",restMethod:"show/inbox",executor:r},{method:"showSent",restMethod:"show/sent",executor:r},{method:"showThreads",restMethod:"show/threads",executor:r},{method:"showThread",restMethod:"show/thread"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"removeThread",restMethod:"delete/thread",verb:"DELETE"}]},{property:"Photos",children:[{method:"create",verb:"POST"},{method:"show"},{method:"search"},{method:"query",executor:r},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PhotoCollections",restNamespace:"collections",children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"search"},{method:"showSubcollections",restMethod:"show/subcollections"},{method:"showPhotos",restMethod:"show/photos"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Places",children:[{method:"create",verb:"POST"},{method:"search",executor:r},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query",executor:r}]},{property:"Posts",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query",executor:r},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PushNotifications",restNamespace:"push_notification",verb:"POST",children:[{method:"subscribe"},{method:"unsubscribe",verb:"DELETE"},{method:"notify"},{method:"subscribeToken",restMethod:"subscribe_token",verb:"POST"},{method:"unsubscribeToken",restMethod:"unsubscribe_token",verb:"DELETE"},{method:"notifyTokens",restMethod:"notify_tokens",verb:"POST"}]},{property:"Reviews",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"SocialIntegrations",restNamespace:"users",children:[{method:"externalAccountLogin",restMethod:"external_account_login",verb:"POST"},{method:"externalAccountLink",restMethod:"external_account_link",verb:"POST"},{method:"externalAccountUnlink",restMethod:"external_account_unlink",verb:"DELETE"},{method:"searchFacebookFriends",restNamespace:"social",restMethod:"facebook/search_friends",executor:s}]},{property:"Statuses",children:[{method:"create",verb:"POST"},{method:"search"},{method:"query",executor:r}]},{property:"Users",children:[{method:"create",verb:"POST"},{method:"login",verb:"POST"},{method:"show"},{method:"showMe",restMethod:"show/me",executor:s},{method:"search",executor:r},{method:"query",executor:r},{method:"update",verb:"PUT"},{method:"logout",executor:function(e){o.call(this,{},function(t){v.reset(),e(t)})}},{method:"remove",restMethod:"delete",verb:"DELETE",executor:function(){var e=arguments;o.call(this,2==e.length?e[0]:{},function(t){v.reset(),(2==e.length?e[1]:e[0])(t)})}},{method:"requestResetPassword",restMethod:"request_reset_password"},{method:"secureCreate",executor:i},{method:"secureLogin",executor:i},{method:"secureStatus",executor:function(){return v.checkStatus()}}]}]});var g;null==g&&(g={}),g.setProperties=function(e,t){if(null!=e&&null!=t)for(var o in t)e[o]=t[o];return e},g.setProperties(g,{percentEncode:function(e){if(null==e)return"";if(e instanceof Array){for(var t="";e.length>0;++e)""!=t&&(t+="&"),t+=g.percentEncode(e[0]);return t}return e=encodeURIComponent(e),e=e.replace(/\!/g,"%21"),e=e.replace(/\*/g,"%2A"),e=e.replace(/\'/g,"%27"),e=e.replace(/\(/g,"%28"),e=e.replace(/\)/g,"%29")},decodePercent:function(e){return null!=e&&(e=e.replace(/\+/g," ")),decodeURIComponent(e)},getParameterList:function(e){if(null==e)return[];if("object"!=typeof e)return g.decodeForm(e+"");if(e instanceof Array)return e;var t,o=[];for(t in e)o.push([t,e[t]]);return o},getParameterMap:function(e){if(null==e)return{};if("object"!=typeof e)return g.getParameterMap(g.decodeForm(e+""));if(e instanceof Array){for(var t={},o=0;e.length>o;++o){var r=e[o][0];void 0===t[r]&&(t[r]=e[o][1])}return t}return e},getParameter:function(e,t){if(!(e instanceof Array))return g.getParameterMap(e)[t];for(var o=0;e.length>o;++o)if(e[o][0]==t)return e[o][1];return null},formEncode:function(e){for(var t="",e=g.getParameterList(e),o=0;e.length>o;++o){var r=e[o][1];null==r&&(r=""),""!=t&&(t+="&"),t+=g.percentEncode(e[o][0])+"="+g.percentEncode(r)}return t},decodeForm:function(e){for(var t=[],e=e.split("&"),o=0;e.length>o;++o){var r=e[o];if(""!=r){var s,n=r.indexOf("=");0>n?(s=g.decodePercent(r),r=null):(s=g.decodePercent(r.substring(0,n)),r=g.decodePercent(r.substring(n+1))),t.push([s,r])}}return t},setParameter:function(e,t,o){var r=e.parameters;if(r instanceof Array){for(e=0;r.length>e;++e)r[e][0]==t&&(void 0===o?r.splice(e,1):(r[e][1]=o,o=void 0));void 0!==o&&r.push([t,o])}else r=g.getParameterMap(r),r[t]=o,e.parameters=r},setParameters:function(e,t){for(var o=g.getParameterList(t),r=0;o.length>r;++r)g.setParameter(e,o[r][0],o[r][1])},completeRequest:function(e,t){null==e.method&&(e.method="GET");var o=g.getParameterMap(e.parameters);null==o.oauth_consumer_key&&g.setParameter(e,"oauth_consumer_key",t.consumerKey||""),null==o.oauth_token&&null!=t.token&&g.setParameter(e,"oauth_token",t.token),null==o.oauth_version&&g.setParameter(e,"oauth_version","1.0"),null==o.oauth_timestamp&&g.setParameter(e,"oauth_timestamp",g.timestamp()),null==o.oauth_nonce&&g.setParameter(e,"oauth_nonce",g.nonce(6)),g.SignatureMethod.sign(e,t)},setTimestampAndNonce:function(e){g.setParameter(e,"oauth_timestamp",g.timestamp()),g.setParameter(e,"oauth_nonce",g.nonce(6))},addToURL:function(e,t){if(newURL=e,null!=t){var o=g.formEncode(t);o.length>0&&(newURL=0>e.indexOf("?")?newURL+"?":newURL+"&",newURL+=o)}return newURL},getAuthorizationHeader:function(e,t){for(var o='OAuth realm="'+g.percentEncode(e)+'"',r=g.getParameterList(t),s=0;r.length>s;++s){var n=r[s],a=n[0];0==a.indexOf("oauth_")&&(o+=","+g.percentEncode(a)+'="'+g.percentEncode(n[1])+'"')}return o},correctTimestamp:function(e){g.timeCorrectionMsec=1e3*e-(new Date).getTime()},timeCorrectionMsec:0,timestamp:function(){var e=(new Date).getTime()+g.timeCorrectionMsec;return Math.floor(e/1e3)},nonce:function(e){for(var t=g.nonce.CHARS,o="",r=0;e>r;++r)var s=Math.floor(Math.random()*t.length),o=o+t.substring(s,s+1);return o}}),g.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",g.declareClass=function(e,t,o){var r=e[t];if(e[t]=o,null!=o&&null!=r)for(var s in r)"prototype"!=s&&(o[s]=r[s]);return o},g.declareClass(g,"SignatureMethod",function(){}),g.setProperties(g.SignatureMethod.prototype,{sign:function(e){var t=this.getSignature(g.SignatureMethod.getBaseString(e));return g.setParameter(e,"oauth_signature",t),t},initialize:function(e,t){var o;o=null!=t.accessorSecret&&e.length>9&&"-Accessor"==e.substring(e.length-9)?t.accessorSecret:t.consumerSecret,this.key=g.percentEncode(o)+"&"+g.percentEncode(t.tokenSecret)}}),g.setProperties(g.SignatureMethod,{sign:function(e,t){var o=g.getParameterMap(e.parameters).oauth_signature_method;(null==o||""==o)&&(o="HMAC-SHA1",g.setParameter(e,"oauth_signature_method",o)),g.SignatureMethod.newMethod(o,t).sign(e)},newMethod:function(e,t){var o=g.SignatureMethod.REGISTERED[e];if(null!=o){var r=new o;return r.initialize(e,t),r}var o=Error("signature_method_rejected"),s="";for(r in g.SignatureMethod.REGISTERED)""!=s&&(s+="&"),s+=g.percentEncode(r);throw o.oauth_acceptable_signature_methods=s,o},REGISTERED:{},registerMethodClass:function(e,t){for(var o=0;e.length>o;++o)g.SignatureMethod.REGISTERED[e[o]]=t},makeSubclass:function(e){var t=g.SignatureMethod,o=function(){t.call(this)};return o.prototype=new t,o.prototype.getSignature=e,o.prototype.constructor=o},getBaseString:function(e){var t=e.action,o=t.indexOf("?");if(0>o)o=e.parameters;else for(var o=g.decodeForm(t.substring(o+1)),r=g.getParameterList(e.parameters),s=0;r.length>s;++s)o.push(r[s]);return g.percentEncode(e.method.toUpperCase())+"&"+g.percentEncode(g.SignatureMethod.normalizeUrl(t))+"&"+g.percentEncode(g.SignatureMethod.normalizeParameters(o))},normalizeUrl:function(e){var t=g.SignatureMethod.parseUri(e),e=t.protocol.toLowerCase(),o=t.authority.toLowerCase();if("http"==e&&80==t.port||"https"==e&&443==t.port){var r=o.lastIndexOf(":");r>=0&&(o=o.substring(0,r))}return(t=t.path)||(t="/"),e+"://"+o+t},parseUri:function(e){for(var t="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(","),e=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),o={},r=14;r--;)o[t[r]]=e[r]||"";return o},normalizeParameters:function(e){if(null==e)return"";for(var t=g.getParameterList(e),e=[],o=0;t.length>o;++o){var r=t[o];"oauth_signature"!=r[0]&&e.push([g.percentEncode(r[0])+" "+g.percentEncode(r[1]),r])}for(e.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),t=[],o=0;e.length>o;++o)t.push(e[o][1]);return g.formEncode(t)}}),g.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],g.SignatureMethod.makeSubclass(function(){return this.key})),g.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],g.SignatureMethod.makeSubclass(function(e){f="=";var t=this.key,o=u(t);o.length>16&&(o=c(o,t.length*T));for(var r=Array(16),t=Array(16),s=0;16>s;s++)r[s]=909522486^o[s],t[s]=1549556828^o[s];for(e=c(r.concat(u(e)),512+e.length*T),e=c(t.concat(e),672),o="",t=0;4*e.length>t;t+=3)for(r=(255&e[t>>2]>>8*(3-t%4))<<16|(255&e[t+1>>2]>>8*(3-(t+1)%4))<<8|255&e[t+2>>2]>>8*(3-(t+2)%4),s=0;4>s;s++)o=8*t+6*s>32*e.length?o+f:o+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&r>>6*(3-s));return o}));var f="",T=8;h.prototype.sendRequest=function(e,t,o,r){var s=l.js.sdk.utils.getAuthType(this);if(s==l.constants.unknown)r(l.constants.noAppKeyError);else{var n=this.apiBaseURL+"/"+l.sdk.url.version+"/"+e,n=s==l.constants.app_key?n+(l.constants.keyParam+this.appKey):n+(l.constants.oauthKeyParam+this.oauthKey);if(null==o&&(o={}),t=t?t.toUpperCase():l.constants.get_method,o[l.constants.suppressCode]="true",!this.isThreeLegged()){var a=l.js.sdk.utils.getCookie(l.constants.sessionId);a||(a=this.session_id),a&&(n=-1!=n.indexOf("?")?n+("&"+l.constants.sessionId+"="+a):n+("?"+l.constants.sessionId+"="+a))}if(this.isThreeLegged()&&(!this.accessToken&&(a=this.getSession())&&(this.accessToken=a.access_token),this.accessToken&&(o[l.constants.accessToken]=this.accessToken)),a=o,Ti.App.analytics){var i=a.analytics||{};i.id=Ti.Platform.createUUID(),Ti.Platform.id&&(i.mid=Ti.Platform.id),i.aguid=Ti.App.guid,i.event="cloud."+e.replace(/\//g,".").replace(/\.json/,""),i.deploytype=Ti.App.deployType||"development",i.sid=Ti.App.sessionId,a.ti_analytics=JSON.stringify(i)}if(o=l.js.sdk.utils.cleanInvalidData(o),e=l.js.sdk.utils.getFileObject(o)){try{var c;if(c=(""+e).match(/TiFilesystemFile/)?e.read():e,!c)return r(l.constants.fileLoadError),void 0;o[l.constants.file]?(delete o[l.constants.file],o[l.constants.file]=c):o[l.constants.photo]&&(delete o[l.constants.photo],o[l.constants.photo]=c)}catch(d){return r(l.constants.fileLoadError),void 0}c={},(s==l.constants.oauth||s==l.constants.three_legged_oauth)&&(s={method:t,action:n,parameters:[]},l.js.sdk.utils.populateOAuthParameters(s.parameters,this.oauthKey),this.oauthSecret&&g.completeRequest(s,{consumerSecret:this.oauthSecret}),c[l.constants.oauth_header]=g.getAuthorizationHeader("",s.parameters))}else if(c={},s==l.constants.oauth||s==l.constants.three_legged_oauth){var u,s={method:t,action:n,parameters:[]};for(u in o)o.hasOwnProperty(u)&&s.parameters.push([u,o[u]]);l.js.sdk.utils.populateOAuthParameters(s.parameters,this.oauthKey),this.oauthSecret&&g.completeRequest(s,{consumerSecret:this.oauthSecret}),c[l.constants.oauth_header]=g.getAuthorizationHeader("",s.parameters)}l.js.sdk.utils.sendAppceleratorRequest(n,t,o,c,r,this)}},h.prototype.sendAuthRequest=function(e){if(l.js.sdk.utils.getAuthType(this)!==l.constants.three_legged_oauth)alert("wrong authorization type!");else{var e=e||{},t=this.authBaseURL,t=t+"/oauth/authorize"+(l.constants.oauthKeyParam+this.oauthKey),t=t+(l.constants.clientIdParam+this.oauthKey),t=t+(l.constants.responseTypeParam+"token"),e=e.params||{};e.action="login",e.url=t;var o=this,r=e.cb;r&&delete e.cb,l.js.sdk.ui(e,function(e){o.saveSession(e),r&&r(e)})}},h.prototype.signUpRequest=function(e){if(l.js.sdk.utils.getAuthType(this)!==l.constants.three_legged_oauth)alert("wrong authorization type!");else{var e=e||{},t=this.authBaseURL,t=t+"/users/sign_up"+(l.constants.oauthKeyParam+this.oauthKey),t=t+(l.constants.clientIdParam+this.oauthKey),e=e.params||{};e.action="signup",e.url=t;var o=this,r=e.cb;r&&delete e.cb,l.js.sdk.ui(e,function(e){o.saveSession(e),r&&r(e)})}},h.prototype.saveSession=function(e){return e&&e.access_token?(l.js.sdk.utils.setCookie(l.constants.accessToken,e.access_token),l.js.sdk.utils.setCookie(l.constants.expiresIn,e.expires_in),this.accessToken=e.access_token,this.expiresIn=e.expires_in,this.authorized=!0):this.authorized=!1},h.prototype.getSession=function(){var e={};return e.access_token=l.js.sdk.utils.getCookie(l.constants.accessToken),e.expires_in=l.js.sdk.utils.getCookie(l.constants.expiresIn),e.access_token?(this.accessToken=e.access_token,this.expiresIn=e.expires_in,this.authorized=!0,e):this.authorized=!1},h.prototype.clearSession=function(){l.js.sdk.utils.setCookie(l.constants.accessToken,""),l.js.sdk.utils.setCookie(l.constants.expiresIn,""),delete this.accessToken,delete this.expiresIn,this.authorized=!1},h.prototype.checkStatus=function(){return this.getSession()?!0:!1},l=void 0,l={constants:{},js:{}},l.js.sdk={},l.js.sdk.utils={},l.sdk={},l.sdk.url={},l.sdk.url.baseURL="https://api.cloud.appcelerator.com",l.sdk.url.authBaseURL="https://secure-identity.cloud.appcelerator.com",l.sdk.url.version="v1",l.constants.get_method="GET",l.constants.post_method="POST",l.constants.put_method="PUT",l.constants.delete_method="DELETE",l.constants.app_key=1,l.constants.oauth=2,l.constants.three_legged_oauth=3,l.constants.unknown=-1,l.constants.keyParam="?key=",l.constants.oauthKeyParam="?oauth_consumer_key=",l.constants.clientIdParam="&client_id=",l.constants.redirectUriParam="&redirect_uri=",l.constants.responseTypeParam="&response_type=",l.constants.accessToken="access_token",l.constants.expiresIn="expires_in",l.constants.appKey="app_key",l.constants.json="json",l.constants.sessionId="_session_id",l.constants.sessionCookieName="Cookie",l.constants.responseCookieName="Set-Cookie",l.constants.file="file",l.constants.suppressCode="suppress_response_codes",l.constants.response_wrapper="response_wrapper",l.constants.photo="photo",l.constants.method="_method",l.constants.name="name",l.constants.value="value",l.constants.oauth_header="Authorization",l.constants.noAppKeyError={meta:{status:"fail",code:409,message:"Application key is not provided."}},l.constants.fileLoadError={meta:{status:"fail",code:400,message:"Unable to load file"}},l.js.sdk.utils.getSessionParams=function(){var e=null,t=l.js.sdk.utils.getCookie(l.constants.sessionId);return t&&(e=l.constants.sessionId+"="+t),e},l.js.sdk.utils.cookieMap=[],l.js.sdk.utils.cookieMap[l.constants.sessionId]="sessionId",l.js.sdk.utils.cookieMap[l.constants.accessToken]="accessToken",l.js.sdk.utils.cookieMap[l.constants.expiresIn]="expiresIn",l.js.sdk.utils.getCookie=function(t){return(t=l.js.sdk.utils.cookieMap[t])&&e[t]||null},l.js.sdk.utils.setCookie=function(t,o){var r=l.js.sdk.utils.cookieMap[t];r&&(""===o?delete e[r]:e[r]=o)},l.js.sdk.utils.deleteCookie=function(t){(t=l.js.sdk.utils.cookieMap[t])&&delete e[t]},l.js.sdk.utils.getAuthType=function(e){if(e){if(e.isThreeLegged())return l.constants.three_legged_oauth;if(e.appKey)return l.constants.app_key;if(e.oauthKey&&e.oauthSecret)return l.constants.oauth}return l.constants.unknown},l.js.sdk.utils.getFileObject=function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)&&(t==l.constants.photo||t==l.constants.file))return e[t];return null},l.js.sdk.utils.cleanInvalidData=function(e){if(e){for(var t in e)if(e.hasOwnProperty(t)){if(null==e[t]&&delete e[t],"object"==typeof e[t]){if(t==l.constants.photo||t==l.constants.file)continue;e[t]=JSON.stringify(e[t])}(!0===e[t]||!1===e[t])&&(e[t]=e[t]?1:0)}return e}return{}},l.js.sdk.utils.uploadMessageCallback=function(e){return e&&e.data?JSON.parse(e.data):{}},l.js.sdk.utils.getOAuthParameters=function(e){var t="";if(e)for(var e=g.getParameterList(e),o=0;e.length>o;++o){var r=e[o],s=r[0];0==s.indexOf("oauth_")&&"oauth_token"!=s&&(t+="&"+g.percentEncode(s)+"="+g.percentEncode(r[1]))}return t.length>0&&(t=t.substring(1)),t},l.js.sdk.utils.populateOAuthParameters=function(e,t){e&&t&&(e.push(["oauth_version","1.0"]),e.push(["oauth_consumer_key",t]),e.push(["oauth_signature_method","HMAC-SHA1"]),e.push(["oauth_nonce",g.nonce(15)]))},l.js.sdk.utils.sendAppceleratorRequest=function(t,o,r,s,n,a){var i=Ti.Network.createHTTPClient({timeout:6e4,onsendstream:function(o){e.onsendstream&&e.onsendstream({url:t,progress:o.progress})},ondatastream:function(o){e.ondatastream&&e.ondatastream({url:t,progress:o.progress})},onerror:function(e){var t={};if(this.responseText){var o=this.responseText;try{(o=o.trim())&&o.length>0&&(t=JSON.parse(o))}catch(r){t=r}}t.message||(t.message=e.error),t.error=!0,t.statusText=this.statusText,t.status=this.status,t.meta&&(t.metaString=JSON.stringify(t.meta)),n(t)},onload:function(){var e=JSON.parse(this.responseText);if(e&&e.meta&&(e.metaString=JSON.stringify(e.meta),e.meta.session_id)){var t=e.meta.session_id;l.js.sdk.utils.setCookie(l.constants.sessionId,t),a.session_id=t}n(e)}}),c=t;if(o.toUpperCase()==l.constants.get_method||o.toUpperCase()==l.constants.delete_method){var d,u="";for(d in r)r.hasOwnProperty(d)&&(u+="&"+d+"="+g.percentEncode(r[d]));u.length>0&&(c=t.indexOf("?")>0?c+u:c+("?"+u.substring(1)),r={})}if(e.debug&&(Ti.API.info(o+": "+c),Ti.API.info("header: "+JSON.stringify(s)),Ti.API.info("data: "+JSON.stringify(r))),i.open(o,c),"mobileweb"!=Ti.Platform.osname&&i.setRequestHeader("Accept-Encoding","gzip,deflate"),s)for(d in s)s.hasOwnProperty(d)&&i.setRequestHeader(d,s[d]);i.send(r)},l.js.sdk.utils.decodeQS=function(e){var t,o,r=decodeURIComponent,s={},e=e.split("&");for(t=0;e.length>t;t++)(o=e[t].split("=",2))&&o[0]&&(s[r(o[0])]=r(o[1]));return s},l.js.sdk.utils.guid=function(){return"f"+(1073741824*Math.random()).toString(16).replace(".","")},l.js.sdk.utils.copy=function(e,t,o,r){for(var s in t)(o||e[s]===void 0)&&(e[s]=r?r(t[s]):t[s]);return e};var v={session:null,fetchSetting:function(e,t){var o,r="production"==Ti.App.deployType.toLowerCase()?"production":"development";return(o=Ti.App.Properties.getString(e+"-"+r))&&"undefined"!=o||(o=Ti.App.Properties.getString(e))&&"undefined"!=o?o:t},fetchSession:function(){var e=v.fetchSetting("acs-api-key",null),t=v.fetchSetting("acs-base-url",l.sdk.url.baseURL),o=v.fetchSetting("acs-authbase-url",l.sdk.url.authBaseURL),r=v.fetchSetting("acs-oauth-key",null),s=v.fetchSetting("acs-oauth-secret",null);return new h(e,r,s,t,o)}};return v.getSession=function(){return null==v.session&&(v.session=v.fetchSession()),v.session},v.send=function(e,t,o,r){v.getSession().sendRequest(e,t,o,r)},v.hasStoredSession=function(){return!!l.js.sdk.utils.getCookie(l.constants.sessionId)},v.retrieveStoredSession=function(){return l.js.sdk.utils.getCookie(l.constants.sessionId)},v.reset=function(){l.js.sdk.utils.deleteCookie(l.constants.sessionId),v.session&&(v.session.clearSession(),v.session=null)},v.secureSend=function(e,t){var o=v.getSession();o.useThreeLegged(!0),"secureCreate"===e?o.signUpRequest(t):"secureLogin"===e&&o.sendAuthRequest(t)},v.checkStatus=function(){return v.getSession().checkStatus()},l.js.sdk.UIManager={redirect_uri:"acsconnect://success",displayModal:function(t){function o(e){var t=/^acsconnect:\/\/([^#]*)#(.*)/.exec(decodeURIComponent(e.url));if(t&&3==t.length){var i=null;if("success"==t[1])i=l.js.sdk.utils.decodeQS(t[2]);else if("cancel"!=t[1])return;n.removeEventListener("beforeload",o),n.removeEventListener("load",o),r=i,s&&s.close()}a&&"load"==e.type&&(s.remove(a),a=null)}e.debug&&Ti.API.info("ThreeLegged Request url: "+t.url);var r,s=Ti.UI.createWindow({modal:!0,title:t.params.title||"Appcelerator Cloud Service"}),n=Ti.UI.createWebView({url:t.url,scalesPageToFit:!1,showScrollbars:!0}),a=Ti.UI.createLabel({text:"Loading, please wait...",color:"black",width:Ti.UI.SIZE||"auto",height:Ti.UI.SIZE||"auto",zIndex:100});if(n.addEventListener("beforeload",o),n.addEventListener("load",o),s.addEventListener("close",function(){t&&(t.cb&&t.cb(r),n=s=a=t=r=null)}),"android"!=Ti.Platform.osname){var i=Ti.UI.createButton({title:"close",width:"50%",height:"20%"});i.addEventListener("click",function(){s.close()}),s.rightNavButton=i}s.add(n),s.add(a),s.open()},processParams:function(e,t){return{cb:t,url:e.url+l.constants.redirectUriParam+l.js.sdk.UIManager.redirect_uri,params:e}}},l.js.sdk.ui=function(e,t){if("mobileweb"===Ti.Platform.osname)alert("Three Legged OAuth is not currently supported on MobileWeb");else if(e.action){var o=l.js.sdk.UIManager.processParams(e,t);o&&l.js.sdk.UIManager.displayModal(o)}else alert('"action" is a required parameter for com.cocoafish.js.sdk.ui().')},e}defineCloud(exports);