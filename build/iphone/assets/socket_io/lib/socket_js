(function(e,t,o){function n(e){if(this.options={port:80,secure:!1,document:"document"in o?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var n=this;t.util.on(o,"beforeunload",function(){n.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function r(){}e.Socket=n,t.util.mixin(n,t.EventEmitter),n.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},n.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},n.prototype.handshake=function(e){function o(t){t instanceof Error?n.onError(t.message):e.apply(null,t.split(":"))}var n=this,i=this.options,s=["http"+(i.secure?"s":"")+":/",i.host+":"+i.port,i.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push(function(e){o(e),c.parentNode.removeChild(c)})}else{var u=t.util.request();u.open("GET",s,!0),u.withCredentials=!0,u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=r,200==u.status?o(u.responseText):!n.reconnecting&&n.onError(u.responseText))},u.send(null)}},n.prototype.getTransport=function(e){for(var o,n=e||this.transports,r=0;o=n[r];r++)if(t.Transport[o]&&t.Transport[o].check(this)&&(!this.isXDomain()||t.Transport[o].xdomainCheck()))return new t.Transport[o](this,this.sessionid);return null},n.prototype.connect=function(e){if(this.connecting)return this;var o=this;return this.handshake(function(n,r,i,s){function a(e){return o.transport&&o.transport.clearTimeouts(),o.transport=o.getTransport(e),o.transport?(o.transport.ready(o,function(){o.connecting=!0,o.publish("connecting",o.transport.name),o.transport.open(),o.options["connect timeout"]&&(o.connectTimeoutTimer=setTimeout(function(){if(!o.connected&&(o.connecting=!1,o.options["try multiple transports"])){o.remainingTransports||(o.remainingTransports=o.transports.slice(0));for(var e=o.remainingTransports;e.length>0&&e.splice(0,1)[0]!=o.transport.name;);e.length?a(e):o.publish("connect_failed")}},o.options["connect timeout"]))}),void 0):o.publish("connect_failed")}o.sessionid=n,o.closeTimeout=1e3*i,o.heartbeatTimeout=1e3*r,o.transports=t.util.intersect(s.split(","),o.options.transports),o.setHeartbeatTimeout(),a(),o.once("connect",function(){clearTimeout(o.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},n.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},n.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},n.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},n.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},n.prototype.disconnectSync=function(){var e=t.util.request(),o=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",o,!0),this.onDisconnect("booted")},n.prototype.isXDomain=function(){return!1},n.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},n.prototype.onOpen=function(){this.open=!0},n.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},n.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},n.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},n.prototype.onDisconnect=function(e){var t=this.connected,o=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||o)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},n.prototype.reconnect=function(){function e(){if(o.connected){for(var e in o.namespaces)o.namespaces.hasOwnProperty(e)&&""!==e&&o.namespaces[e].packet({type:"connect"});o.publish("reconnect",o.transport.name,o.reconnectionAttempts)}clearTimeout(o.reconnectionTimer),o.removeListener("connect_failed",t),o.removeListener("connect",t),o.reconnecting=!1,delete o.reconnectionAttempts,delete o.reconnectionDelay,delete o.reconnectionTimer,delete o.redoTransports,o.options["try multiple transports"]=r}function t(){return o.reconnecting?o.connected?e():o.connecting&&o.reconnecting?o.reconnectionTimer=setTimeout(t,1e3):(o.reconnectionAttempts++>=n?o.redoTransports?(o.publish("reconnect_failed"),e()):(o.on("connect_failed",t),o.options["try multiple transports"]=!0,o.transport=o.getTransport(),o.redoTransports=!0,o.connect()):(i>o.reconnectionDelay&&(o.reconnectionDelay*=2),o.connect(),o.publish("reconnecting",o.reconnectionDelay,o.reconnectionAttempts),o.reconnectionTimer=setTimeout(t,o.reconnectionDelay)),void 0):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var o=this,n=this.options["max reconnection attempts"],r=this.options["try multiple transports"],i=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);