(function(e,t){function o(e,t){this.socket=e,this.sessid=t}e.Transport=o,t.util.mixin(o,t.EventEmitter),o.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var o=t.parser.decodePayload(e);if(o&&o.length)for(var n=0,r=o.length;r>n;n++)this.onPacket(o[n])}return this},o.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),this.socket.onPacket(e),this)},o.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},o.prototype.onDisconnect=function(){return this.close&&this.open&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},o.prototype.onConnect=function(){return this.socket.onConnect(),this},o.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},o.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},o.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},o.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},o.prototype.onOpen=function(){this.open=!0,this.clearCloseTimeout(),this.socket.onOpen()},o.prototype.onClose=function(){this.open=!1,this.socket.onClose(),this.onDisconnect()},o.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},o.prototype.ready=function(e,t){t.call(this)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);