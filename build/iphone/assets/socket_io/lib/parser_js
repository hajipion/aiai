(function(e,t){var o=e.parser={},n=o.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],r=o.reasons=["transport not supported","client not handshaken","unauthorized"],i=o.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;o.encodePacket=function(e){var t=a(n,e.type),o=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var p=e.reason?a(r,e.reason):"",h=e.advice?a(i,e.advice):"";(""!==p||""!==h)&&(l=p+(""!==h?"+"+h:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var d={name:e.name};e.args&&e.args.length&&(d.args=e.args),l=s.stringify(d);break;case"json":l=s.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var f=[t,o+("data"==u?"+":""),c];return null!==l&&void 0!==l&&f.push(l),f.join(":")},o.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var o=0,n=e.length;n>o;o++){var r=e[o];t+="�"+r.length+"�"+e[o]}return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;o.decodePacket=function(e){var t=e.match(c);if(!t)return{};var o=t[2]||"",e=t[5]||"",a={type:n[t[1]],endpoint:t[4]||""};switch(o&&(a.id=o,a.ack=t[3]?"data":!0),a.type){case"error":var t=e.split("+");a.reason=r[t[0]]||"",a.advice=i[t[1]]||"";break;case"message":a.data=e||"";break;case"event":try{var u=s.parse(e);a.name=u.name,a.args=u.args}catch(l){}a.args=a.args||[];break;case"json":try{a.data=s.parse(e)}catch(l){}break;case"connect":a.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t&&(a.ackId=t[1],a.args=[],t[3]))try{a.args=t[3]?s.parse(t[3]):[]}catch(l){}break;case"disconnect":case"heartbeat":}return a},o.decodePayload=function(e){if("�"==e.charAt(0)){for(var t=[],n=1,r="";e.length>n;n++)"�"==e.charAt(n)?(t.push(o.decodePacket(e.substr(n+1).substr(0,r))),n+=Number(r)+1,r=""):r+=e.charAt(n);return t}return[o.decodePacket(e)]}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);