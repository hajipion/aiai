(function(e,t){function o(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new n(this,"json"),this.ackPackets=0,this.acks={}}function n(e,t){this.namespace=e,this.name=t}e.SocketNamespace=o,t.util.mixin(o,t.EventEmitter),o.prototype.$emit=t.EventEmitter.prototype.emit,o.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},o.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},o.prototype.send=function(e,t){var o={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(o.id=++this.ackPackets,o.ack=!0,this.acks[o.id]=t),this.packet(o)},o.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),o=t[t.length-1],n={type:"event",name:e};return"function"==typeof o&&(n.id=++this.ackPackets,n.ack="data",this.acks[n.id]=o,t=t.slice(0,t.length-1)),n.args=t,this.packet(n)},o.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},o.prototype.onPacket=function(e){function o(){n.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var n=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var r=["message",e.data];"data"==e.ack?r.push(o):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,r);break;case"event":var r=[e.name].concat(e.args);"data"==e.ack&&r.push(o),this.$emit.apply(this,r);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},n.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},n.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);