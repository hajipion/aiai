var fs=require("fs"),socket=require("../lib/io"),uglify=require("uglify-js"),activeXObfuscator=require("active-x-obfuscator"),template="/*! Socket.IO.%ext% build:"+socket.version+", %type%. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */\n",development=template.replace("%type%","development").replace("%ext%","js"),production=template.replace("%type%","production").replace("%ext%","min.js"),starttagIF="// if node",endtagIF="// end node",base=["io.js","util.js","events.js","json.js","parser.js","transport.js","socket.js","namespace.js"],baseTransports={websocket:["transports/websocket.js"],flashsocket:["transports/websocket.js","transports/flashsocket.js","vendor/web-socket-js/swfobject.js","vendor/web-socket-js/web_socket.js"],htmlfile:["transports/xhr.js","transports/htmlfile.js"],"xhr-polling":["transports/xhr.js","transports/xhr-polling.js"],"jsonp-polling":["transports/xhr.js","transports/xhr-polling.js","transports/jsonp-polling.js"]},builder=module.exports=function(){var e,t,r,o=null,i=Array.prototype.slice.call(arguments,0),n={minify:!0,node:!1,custom:[]};i.forEach(function(o){var i=Object.prototype.toString.call(o).replace(/\[object\s(\w+)\]/gi,"$1").toLowerCase();switch(i){case"array":return e=o;case"object":return t=o;case"function":return r=o}}),t=t||{},e=e||Object.keys(baseTransports);for(var a in t)n[a]=t[a];var s=[];if(base.forEach(function(e){s.push(__dirname+"/../lib/"+e)}),e.forEach(function(e){var t=baseTransports[e];return t?(t.forEach(function(e){var t=__dirname+"/../lib/"+e;~s.indexOf(t)||s.push(t)}),void 0):(o="Unsupported transport `"+e+"` supplied as argument.",void 0)}),o)return r(o);var u={};s.forEach(function(e){fs.readFile(e,function(t,i){if(t&&(o=t),u[e]=i,Object.keys(u).length===s.length){if(o)return r(o);var a=development,l=0;if(s.forEach(function(e){a+=u[e]}),n.custom.length&&n.custom.forEach(function(e){a+=e}),a=activeXObfuscator(a),n.node||(a=a.split("\n").filter(function(e){var t=e.indexOf(starttagIF)>=0,r=e.indexOf(endtagIF)>=0,o=l;return t&&(l++,o=l),r&&l--,0==o}).join("\n")),n.minify){var c=uglify.parser.parse(a);c=uglify.uglify.ast_mangle(c),c=uglify.uglify.ast_squeeze(c),a=production+uglify.uglify.gen_code(c,{ascii_only:!0})}r(o,a)}})})};if(builder.version=socket.version,builder.transports=baseTransports,!module.parent){var args=process.argv.slice(2);builder(args.length?args:!1,{minify:!1},function(e,t){return e?console.error(e):(fs.write(fs.openSync(__dirname+"/../dist/socket.io.js","w"),t,0,"utf8"),console.log("Successfully generated the development build: socket.io.js"),void 0)}),builder(args.length?args:!1,function(e,t){return e?console.error(e):(fs.write(fs.openSync(__dirname+"/../dist/socket.io.min.js","w"),t,0,"utf8"),console.log("Successfully generated the production build: socket.io.min.js"),void 0)})}