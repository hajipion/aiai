var builder=require("../../bin/builder"),common=require("./builder.common"),should=require("should");module.exports={"version number":function(){builder.version.should().match(/([0-9]+)\.([0-9]+)\.([0-9]+)/),builder.version.should().equal(require("../../lib/io").version)},"production build LOC":function(){builder(function(e,t){should.strictEqual(e,null);var n=t.split("\n");n.length.should().be.below(5),n[0].should().match(/production/gi),Buffer.byteLength(t).should().be.below(43e3)})},"development build LOC":function(){builder({minify:!1},function(e,t){should.strictEqual(e,null);var n=t.split("\n");n.length.should().be.above(5),n[0].should().match(/development/gi),Buffer.byteLength(t).should().be.above(35e3)})},"default builds":function(){builder(function(e,t){should.strictEqual(e,null);var n=common.execute(t).io,o=Object.keys(n.Transport),r=Object.keys(builder.transports);o.length.should().be.equal(r.length+1),r.forEach(function(e){o.indexOf(e).should().be.above(-1)})})},"custom build":function(){builder(["websocket"],function(e,t){should.strictEqual(e,null);var n=common.execute(t).io,o=Object.keys(n.Transport);o.should().have.length(1),o[0].should().eql("websocket")})},"custom code":function(){var e='var hello = "world";';builder({custom:[e],minify:!1},function(t,n){should.strictEqual(t,null),n.should().include.string(e)})},"node if":function(){var e='// if node \nvar hello = "world";\n// end node\nvar pew = "pew";';builder({custom:[e],minify:!1},function(t,n){should.strictEqual(t,null),n.should().not.include.string(e),n.should().not.include.string("// if node"),n.should().not.include.string("// end node"),n.should().not.include.string('"world"'),n.should().include.string('var pew = "pew"')})},"preserve the encoding during minification":function(){builder(function(e,t){should.strictEqual(e,null),t.should().match(/(\\ufffd)/g)})},globals:function(){builder(function(e,t){should.strictEqual(e,null);var n=common.execute(t),o=common.env(),r=["io","swfobject","WEB_SOCKET_DISABLE_AUTO_INITIALIZATION"];Array.prototype.push.apply(r,Object.keys(o)),Object.keys(n).forEach(function(e){var t=r.indexOf(e);if(!~t)throw Error("Global leak: "+e)})})}};